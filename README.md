# Waiter! 开放平台

## 项目设计

![1](./assets/1.png)

- 核心业务后端 waiter-backend
  - 用户管理
    1. 注册 / 登陆 / 登出
    2. 获取当前登陆用户视图 [需要登陆]
    3. 更改用户信息 [需要登陆]
    4. 注销账号 [需要登陆]
    5. 查询状态正常的用户视图 [需要登陆] (包括账号和昵称的模糊查询)
    6. 条件查询用户信息 [管理员]
    7. 封禁 / 解封用户 [管理员]
    8. 置为管理员 / 降为普通用户 [超级管理员]
  - 接口信息管理
    1. 查询状态正常的接口信息视图 (包括接口名和描述的模糊查询)
    2. 查看某一接口的详细接口信息视图 (包括调用统计)
    3. 条件查询接口信息 [管理员]
    4. 更改接口信息 [管理员]
    5. 新增接口信息 [管理员]
    6. 删除接口信息 [管理员]
    7. 上线 / 关闭接口信息 [对应的管理员]
  - 调用管理
    1. 在线调用某一接口服务 [需要登陆] (如果用户没有调用过该接口服务，则自动创建调用关系，并默认获得若干调用次数)
    2. 增加调用次数
    3. 查看自己的接口调用统计 [需要登陆]
    4. 封禁 / 解封用户调用某一接口 [管理员]
    5. 查询用户与接口的调用关系 [管理员]
    6. 查询某一接口的调用统计
    7. 查询某一接口的用户调用统计 [管理员]
    8. 利用 SDK 调用某一接口服务
- 公共模块 waiter-common
  - 实体类，视图和枚举类
  - 自定义注解
  - 自定义异常
  - 通用返回类
  - 通用请求类
  - RPC 服务接口
  - 工具类
  - 实体字段校验类
  - 常量
- 网关 waiter-gateway
- 服务后端 waiter-service
- 开发工具包 waiter-sdk
  - 在配置中设置用户的 ak 和 sk，用于自动装配 WaiterClient
  - 使用 WaiterClient 快速调用接口服务

## 开发历程

[1] 开发提供服务的后端应用 waiter-service

1. 设置应用的端口号为 8180，上下文路径为 /api
2. 开发服务接口 EncryptController，提供一个方法 md5Encrypt，传入一个对象，返回将该对象加密后的字符串

[2] 开发客户端调用工具 waiter-sdk

1. 开发配置类 ClientConfig，使客户端可以通过在项目中配置元数据的方式，将密钥对自动装配到配置类中，并用该密钥对创建 Clinet 组件，从而便于客户端注入使用，Client 类的作用是简化客户端调用接口服务的过程
2. 在 Client 类中提供 post 方法和 getHeader 方法
   - post 方法的第一个参数是被调用接口服务的 URI (如 /api/encrypt/md5)，第二个参数是请求体对象 (可以为空)，方法返回响应体对象
   - getHeader 方法传入一个序列化后的请求体，返回一个包含签名信息的键值对

[3] 开发模拟用户客户端应用

1. 在 application.yaml 中配置用户的密钥对，并设置应用端口号为 8380
2. 在接口实现类中注入 Client 类的对象，调用 post 方法，传入接口服务的 URI 和请求体对象，获取接口服务的结果

[4] 开发网关 waiter-gateway

1. 设置应用的端口号为 8280
2. 配置路由转发
3. 定义自定义全局过滤器，打印请求日志和请求头中的签名
   - todo

[5] 